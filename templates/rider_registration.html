{% extends "base.html" %}

{% block title %}Riders Registration - Stallion Routes{% endblock %}

{% block content %}
<header>
    <nav class="navbar navbar-expand-lg px-4 bg-dark">
        <a class="navbar-brand" href="#">Stallion Routes</a>
        <div class="ms-auto">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="btn btn-sm btn-outline-light" style="--bs-btn-border-width: 2px;" href="{{ url_for('rider_login') }}">Login</a></li>
            </ul>
        </div>
</header>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-md-10 col-12">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="col-12">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            <div class="card">
                <div class="card-header text-center top-nav text-black">
                    <h4 class="m-0">Riders Registration Form</h4>
                </div>
                <div class="card-body">
                    <form id="form-rider-reg" action="/rider_registration" method="POST" enctype="multipart/form-data"> <!-- enctype="multipart/form-data" -->
                        <div id="rider-reg">
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_name" class="form-label">Full Name:</label>
                                    <p><input type="text" id="rider_name" name="rider_name" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Name" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters and spaces allowed." required></p>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_email" class="form-label">Email:</label>
                                    <p><input type="email" id="rider_email" name="rider_email" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Email" title="Please enter a valid email address." required></p>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_number" class="form-label">Phone Number:</label>
                                    <p><input type="text" id="rider_number" name="rider_number" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Number (e.g. 09012345678)" pattern="^0\d{10}$" title="Phone number must start with 0 and be 11 digits long (e.g. 09012345678)" required></p>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_age" class="form-label">Age:</label>
                                    <p><input type="number" id="rider_age" name="rider_age" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Age" min="0" pattern="^[0-9]{1,3}$" title="Please enter a valid age (1-120)" required></p>        
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="residential_address" class="form-label">Residential Address:</label>
                                    <p><input type="text" id="residential_address" name="residential_address" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Address" pattern="^[A-Za-z0-9\s,.'-]{5,100}$" title="Please enter a valid address (5-100 characters)" required></p>        
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_city" class="form-label">City:</label>
                                    <p><input type="text" id="rider_city" name="rider_city" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="City" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces, and hyphens are allowed." required></p>     
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_state" class="form-label">State:</label>
                                    <!-- <p><input type="text" id="rider_state" name="rider_state" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your state" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces, and hyphens are allowed." required></p> -->
                                    <select id="rider_state" name="rider_state" class="form-select form-control border focus-ring" style="--bs-border-color :#EE940D; --bs-focus-ring-color :rgba(238, 148, 13, 0.48);" required>
                                        <option value="" disabled selected>Enter your state</option>
                                        <option value="Abuja">Abuja</option>
                                        <option value="Abia">Abia</option>
                                        <option value="Adamawa">Adamawa</option>
                                        <option value="Akwa Ibom">Akwa Ibom</option>
                                        <option value="Anambra">Anambra</option>
                                        <option value="Bauchi">Bauchi</option>
                                        <option value="Bayelsa">Bayelsa</option>
                                        <option value="Benue">Benue</option>
                                        <option value="Borno">Borno</option>
                                        <option value="Cross River">Cross River</option>
                                        <option value="Delta">Delta</option>
                                        <option value="Ebonyi">Ebonyi</option>
                                        <option value="Edo">Edo</option>
                                        <option value="Ekiti">Ekiti</option>
                                        <option value="Enugu">Enugu</option>
                                        <option value="Gombe">Gombe</option>
                                        <option value="Imo">Imo</option>
                                        <option value="Jigawa">Jigawa</option>
                                        <option value="Kaduna">Kaduna</option>
                                        <option value="Kano">Kano</option>
                                        <option value="Katsina">Katsina</option>
                                        <option value="Kebbi">Kebbi</option>
                                        <option value="Kogi">Kogi</option>
                                        <option value="Kwara">Kwara</option>
                                        <option value="Lagos">Lagos</option>
                                        <option value="Nasarawa">Nasarawa</option>
                                        <option value="Niger">Niger</option>
                                        <option value="Ogun">Ogun</option>
                                        <option value="Ondo">Ondo</option>
                                        <option value="Osun">Osun</option>
                                        <option value="Oyo">Oyo</option>
                                        <option value="Plateau">Plateau</option>
                                        <option value="Rivers">Rivers</option>
                                        <option value="Sokoto">Sokoto</option>
                                        <option value="Taraba">Taraba</option>
                                        <option value="Yobe">Yobe</option>
                                        <option value="Zamfara">Zamfara</option>
                                    </select>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="nin" class="form-label">National Identification Number (NIN):</label>
                                    <p><input type="text" id="nin" name="nin" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="NIN" pattern="^[0-9]{11}$" title="NIN must be 11 digits long." required></p>        
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="acct_num" class="form-label">Account Number:</label>
                                    <p><input type="text" id="acct_num" name="acct_num" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Account Number" pattern="^[0-9]{10}$" title="Account Number must be 10 digits long." required></p>        
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="bank_name" class="form-label">Bank Name:</label>
                                    <p><input type="text" id="bank_name" name="bank_name" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Bank Name" pattern="^[A-Za-z\s]{2,50}$" title="Only letters and spaces are allowed." required></p>        
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="rider_vehicle" class="form-label">Vehicle:</label>
                                    <p><input type="text" id="rider_vehicle" name="rider_vehicle" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Keke-Napep or Bike" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces and hyphens are allowed." required></p>        
                                </div>
                            </div>
                            <!-- for Guarantor's-->
                            <h4>Guarantor's Form</h4>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_name" class="form-label">Guarantor Name:</label>
                                    <p><input type="text" id="guarantor_name" name="guarantor_name" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Guarantor Name" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces and hyphens are allowed." required></p>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_number" class="form-label">Guarantor Phone Number:</label>
                                    <p><input type="tel" id="guarantor_number" name="guarantor_number" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Guarantor Number" pattern="^^0\d{10}$" title="Guarantor Phone Number must be 11 digits long." required></p>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_residential_address" class="form-label">Residential Address:</label>
                                    <p><input type="text" id="guarantor_residential_address" name="guarantor_residential_address" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your Address" pattern="^[A-Za-z0-9\s\-\,\.]{5,100}$" title="Only letters, numbers, spaces, hyphens, commas, and periods are allowed." required></p>        
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_relatioship" class="form-label">Relationship:</label>
                                    <p><input type="text" id="guarantor_relatioship" name="guarantor_relationship" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Relationship" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces and hyphens are allowed." required></p>        
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_occupation" class="form-label">Occupation:</label>
                                    <p><input type="text" id="guarantor_occupation" name="guarantor_occupation" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Guarantor Occupation" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces and hyphens are allowed." required></p>
                                </div>
                                <div class="col-lg-6 col-md-6 col-12">
                                    <label for="guarantor_state" class="form-label">State of Origin:</label>
                                    <!-- <p><input type="text" id="guarantor_state" name="guarantor_state" class="form-control border focus-ring" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48);" placeholder="Your state of residence" pattern="^[A-Za-z\s\-']{2,50}$" title="Only letters, spaces and hyphens are allowed." required></p> -->
                                    <select id="guarantor_state" name="guarantor_state" class="form-select form-control border focus-ring" style="--bs-border-color :#EE940D; --bs-focus-ring-color :rgba(238, 148, 13, 0.48);" required>
                                        <option value="" disabled selected>Enter your state</option>
                                        <option value="Abuja">Abuja</option>
                                        <option value="Abia">Abia</option>
                                        <option value="Adamawa">Adamawa</option>
                                        <option value="Akwa Ibom">Akwa Ibom</option>
                                        <option value="Anambra">Anambra</option>
                                        <option value="Bauchi">Bauchi</option>
                                        <option value="Bayelsa">Bayelsa</option>
                                        <option value="Benue">Benue</option>
                                        <option value="Borno">Borno</option>
                                        <option value="Cross River">Cross River</option>
                                        <option value="Delta">Delta</option>
                                        <option value="Ebonyi">Ebonyi</option>
                                        <option value="Edo">Edo</option>
                                        <option value="Ekiti">Ekiti</option>
                                        <option value="Enugu">Enugu</option>
                                        <option value="Gombe">Gombe</option>
                                        <option value="Imo">Imo</option>
                                        <option value="Jigawa">Jigawa</option>
                                        <option value="Kaduna">Kaduna</option>
                                        <option value="Kano">Kano</option>
                                        <option value="Katsina">Katsina</option>
                                        <option value="Kebbi">Kebbi</option>
                                        <option value="Kogi">Kogi</option>
                                        <option value="Kwara">Kwara</option>
                                        <option value="Lagos">Lagos</option>
                                        <option value="Nasarawa">Nasarawa</option>
                                        <option value="Niger">Niger</option>
                                        <option value="Ogun">Ogun</option>
                                        <option value="Ondo">Ondo</option>
                                        <option value="Osun">Osun</option>
                                        <option value="Oyo">Oyo</option>
                                        <option value="Plateau">Plateau</option>
                                        <option value="Rivers">Rivers</option>
                                        <option value="Sokoto">Sokoto</option>
                                        <option value="Taraba">Taraba</option>
                                        <option value="Yobe">Yobe</option>
                                        <option value="Zamfara">Zamfara</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="text-start mb-2">
                                    <label for="profile_picture" class="form-label">Click the box below to upload your profile picture:</label>
                                    <p class="text-muted">* Upload a clear image of your face and max size of 15Mb</p>
                                </div>
                                <div class="form-control border focus-ring d-flex p-0 mx-3" style="--bs-border-color: #EE940D; --bs-focus-ring-color: rgba(238, 148, 13, 0.48); height: 200px; width: 200px;">   
                                    <img id="profile-picture-preview" src="{{ url_for('static', filename='uploads/') }}" alt="Profile Picture" class="img-thumbnail" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;">
                                    <input type="file" id="profile_picture" name="profile_pictures" class="d-none" accept="image/*">
                                </div>

                                <script>
                                    // Profile picture preview (upload from file)
                                    document.getElementById('profile-picture-preview').addEventListener('click', function() {
                                        document.getElementById('profile_picture').click();
                                    });
                                
                                    document.getElementById('profile_picture').addEventListener('change', function(event) {
                                        const file = event.target.files[0];
                                        if (file) {
                                            const reader = new FileReader();
                                            reader.onload = function(e) {
                                                document.getElementById('profile-picture-preview').src = e.target.result;
                                            };
                                            reader.readAsDataURL(file);
                                        }
                                    });
                                </script>
                                <!-- Update Profile Picture End -->
                            </div>

                            <div class="mb-4 p-1">
                                <button type="submit" class="btn btn-md btn-stallion">Register</button>
                            </div>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <p>Have an account? <a href="{{ url_for('rider_login') }}" class="text-decoration-none text-color">Login</a></p>
                        <p style="font-size: 12px;">By signing in, you agree to our <span class="text-color">Terms of Service</span> and <span class="text-color">Privacy Policy.</span></p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3">
                <p class="text-muted">© <script>document.write(new Date().getFullYear())</script> Stallion Group. All rights reserved.</p>
            </div>
        </div>
    </div>
</div>

<script>
  document.getElementById('signup-form').addEventListener('submit', function(e) {
    const form = e.target;

    const rider_name = form.rider_name.value.trim();
    // const rider_email = form.rider_email.value.trim(); pattern="/^[^\s@]+@[^\s@]+\.[^\s@]+$/"
    const rider_number = form.rider_number.value.trim();
    const rider_age = form.rider_age.value.trim();
    const residential_address = form.residential_address.value.trim();
    const rider_city = form.rider_city.value.trim();
    const rider_state = form.rider_state.value.trim();
    const nin = form.nin.value.trim();
    const acct_num = form.acct_num.value.trim();
    const bank_name = form.bank_name.value.trim();
    const rider_vehicle = form.rider_vehicle.value.trim();
    const guarantor_name = form.guarantor_name.value.trim();
    const guarantor_number = form.guarantor_number.value.trim();
    const guarantor_residential_address = form.guarantor_residential_address.value.trim();
    const guarantor_relationship = form.guarantor_relationship.value.trim();
    const guarantor_occupation = form.guarantor_occupation.value.trim();
    const guarantor_state = form.guarantor_state.value.trim();

    const nameRegex = /^[A-Za-z\s\-']{2,50}$/;
    // const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const numberRegex = /^\+?\d{10,15}$/;
    const ageRegex = /^[0-9]{1,3}$/;
    const addressRegex = /^[A-Za-z0-9\s,.'-]{5,100}$/;
    const ninRegex = /^[0-9]{11}$/;
    const acct_NumRegex = /^[0-9]{10}$/;
    const bank_nameRegex = /^[A-Za-z\s]{2,50}$/;
    const vehicleRegex = /^[A-Za-z\s\-']{2,50}$/;
    const relationshipRegex = /^[A-Za-z\s\-']{2,50}$/;
    const occupationRegex = /^[A-Za-z\s\-']{2,50}$/;
    const stateRegex = /^[A-Za-z\s\-']{2,50}$/;

    if (!nameRegex.test(rider_name) || !nameRegex.test(guarantor_name)) {
      alert("Name must contain only letters, spaces, hyphens, or apostrophes.");
      e.preventDefault();
      return;
    }

    // if (!emailRegex.test(rider_email)) {
    //   alert("Please enter a valid email address.");
    //   e.preventDefault();
    //   return;
    // }

    if (!numberRegex.test(rider_number) || !numberRegex.test(guarantor_number)) {
      alert("Phone number must be valid and in international format (e.g., +234...).");
      e.preventDefault();
      return;
    }

    if (!ageRegex.test(rider_age) || rider_age < 1 || rider_age > 120) {
      alert("Please enter a valid age (1-120).");
      e.preventDefault();
      return;
    }

    if (!addressRegex.test(residential_address) || !addressRegex.test(guarantor_residential_address)) {
      alert("Please enter a valid address (5-100 characters).");
      e.preventDefault();
      return;
    }

    if (!ninRegex.test(nin)) {
      alert("Invalid NIN. It must be 11 digits long.");
      e.preventDefault();
      return;
    }

    if (!acct_NumRegex.test(acct_num)) {
      alert("Invalid account number. It must be 10 digits long.");
      e.preventDefault();
      return;
    }

    if (!bank_nameRegex.test(bank_name)) {
      alert("Invalid bank name.");
      e.preventDefault();
      return;
    }

    if (!vehicleRegex.test(rider_vehicle)) {
      alert("Invalid vehicle type.");
      e.preventDefault();
      return;
    }

    if (!relationshipRegex.test(guarantor_relationship)) {
      alert("Relationship must contain only letters, spaces, hyphens, or apostrophes.");
      e.preventDefault();
      return;
    }

    if (!occupationRegex.test(guarantor_occupation)) {
      alert("Invalid occupation.");
      e.preventDefault();
      return;
    }

    if (!stateRegex.test(rider_city)) {
      alert("Invalid state or city.");
      e.preventDefault();
      return;
    }

    // Optional: Add a loading spinner here
  });
</script>

{% endblock %}